<!DOCTYPE html>
<html>
<head>
<style>
  /* Define the ground */
  .ground {
    width: 100%;
    height: 20px;
    background-color: #663300;
    position: absolute;
    bottom: 0;
  }

  /* Define Donkey Kong */
  .donkey-kong {
    width: 50px;
    height: 70px;
    background-color: brown;
    position: absolute;
    bottom: 20px;
    left: 50px;
  }

  /* Define Mario */
  .mario {
    width: 20px;
    height: 30px;
    background-color: red;
    position: absolute;
    bottom: 20px;
    left:700px; /* Start Mario from the right */
  }

  /* Define blocks */
  .block {
    width: 30px;
    height: 20px;
    background-color: gray;
    position: absolute;
    bottom: 20px;
    left: -30px; /* Start blocks from the left side */
    animation: moveBlock 5s linear infinite;
  }

  /* Define floors */
  .floor {
    width: 100%;
    height: 20px;
    background-color: #663300;
    position: absolute;
  }

  /* Create different floors */
  .floor-1 {
    top: 100px;
  }

  .floor-2 {
    top: 200px;
  }

  .floor-3 {
    top: 300px;
  }

  /* Winning message */
  .win-message, .lose-message {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
  }
  
  /* Winning message link style */
  .win-message a {
    color: blue;
    text-decoration: underline;
    cursor: pointer;
  }

  /* Keyframes for block movement */
  @keyframes moveBlock {
    from {
      left: -30px;
    }
    to {
      left: 100%;
    }
  }
</style>
</head>
<body>

<!-- Create the ground -->
<div class="ground"></div>

<!-- Create Donkey Kong -->
<div class="donkey-kong"></div>

<!-- Create Mario -->
<div class="mario"></div>

<!-- Create blocks -->
<div class="block" id="block1"></div>
<div class="block" id="block2" style="left: 200px;"></div>
<div class="block" id="block3" style="left: 400px;"></div>

<!-- Create floors -->
<div class="floor floor-1"></div>
<div class="floor floor-2"></div>
<div class="floor floor-3"></div>

<!-- Winning and losing messages -->
<div class="win-message" id="win-message">
  You Win! <a href="new_level.html">Next Level</a>
</div>
<div class="lose-message" id="lose-message">You Lose. Press R to Restart.</div>

<script>
  // Get references to the Mario, Donkey Kong, and winning/losing message elements
  const mario = document.querySelector(".mario");
  const donkeyKong = document.querySelector(".donkey-kong");
  const winMessage = document.querySelector("#win-message");
  const loseMessage = document.querySelector("#lose-message");

  // Get references to the block elements
  const blocks = document.querySelectorAll(".block");

  // Set initial positions and jump variables
  let marioX = 450; // Start Mario from the right
  let marioY = 20; // Initial Y position
  let isJumping = false;

  // Define a function to move Mario
  function moveMario(direction) {
    if (winMessage.style.display === "block" || loseMessage.style.display === "block") {
      return; // Don't allow movement after winning or losing
    }

    if (direction === "a") {
      marioX -= 10;
    } else if (direction === "d") {
      marioX += 10;
    } else if (direction === "w" && !isJumping) {
      // Only allow jumping if not currently jumping
      isJumping = true;
      jumpMario();
    }

    mario.style.left = marioX + "px";

    // Check for collision with blocks
    for (const block of blocks) {
      if (isColliding(mario, block)) {
        // Mario has collided with a block, so he loses
        loseMessage.style.display = "block";
      }
    }

    // Check for collision with Donkey Kong
    if (isColliding(mario, donkeyKong)) {
      // Mario has touched Donkey Kong, so he wins
      winMessage.style.display = "block";
    }
  }

  // Define a function to handle Mario's jump
  function jumpMario() {
    let jumpHeight = 100; // Set the jump height
    let jumpDuration = 1000; // Set the jump duration (in milliseconds)

    let startTime = null;
    function animateJump(timestamp) {
      if (!startTime) {
        startTime = timestamp;
      }

      const progress = timestamp - startTime;

      if (progress < jumpDuration) {
        const jumpY = easeInOutQuad(progress, 0, jumpHeight, jumpDuration);
        mario.style.bottom = marioY + jumpY + "px";
        requestAnimationFrame(animateJump);
      } else {
        // Jump completed
        marioY = 20; // Reset Mario's Y position
        mario.style.bottom = marioY + "px";
        isJumping = false;
      }
    }

    requestAnimationFrame(animateJump);
  }

  // Easing function for smooth jump
  function easeInOutQuad(t, b, c, d) {
    t /= d / 2;
    if (t < 1) return (c / 2) * t * t + b;
    t--;
    return (-c / 2) * (t * (t - 2) - 1) + b;
  }

  // Check for collision between two elements
  function isColliding(element1, element2) {
    const rect1 = element1.getBoundingClientRect();
    const rect2 = element2.getBoundingClientRect();
    return (
      rect1.left < rect2.right &&
      rect1.right > rect2.left &&
      rect1.top < rect2.bottom &&
      rect1.bottom > rect2.top
    );
  }

  // Listen for keydown events to control Mario and restart the game
  document.addEventListener("keydown", function (event) {
    const key = event.key;
    if (key === "a" || key === "d" || key === "w") {
      moveMario(key);
    } else if (key === "r") {
      // Restart the game when "R" key is pressed
      restartGame();
    }
  });

  // Function to restart the game
  function restartGame() {
    winMessage.style.display = "none";
    loseMessage.style.display = "none";
    marioX = 450;
    mario.style.left = marioX + "px";
  }
</script>

</body>
</html>
